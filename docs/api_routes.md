# API Gateway HTTP 路由

下表列出了通过 API Gateway 暴露的所有 HTTP 路由及其对应的后端 gRPC 服务和方法。

| HTTP Method | Path                                       | gRPC Service      | gRPC Method              | Description                       | Example Response Body (JSON)                                                                                                                                                              |
| :---------- | :----------------------------------------- | :---------------- | :----------------------- | :-------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **User Service** |                                            |                   |                          |                                   |                                                                                                                                                                                           |
| POST        | `/v1/users`                                | UserService       | CreateUser               | 创建新用户                        | `{ "user": { "user_id": "uuid-string", "username": "new_user", "created_at": "timestamp-string" } }`                                                                                       |
| GET         | `/v1/users/{user_id}`                      | UserService       | GetUser                  | 获取用户信息                      | `{ "user": { "user_id": "uuid-string", "username": "existing_user", "created_at": "timestamp-string" } }`                                                                                 |
| PATCH       | `/v1/users/{user.user_id}`                 | UserService       | UpdateUser               | 更新用户信息                      | `{ "user": { "user_id": "uuid-string", "username": "updated_user", "created_at": "timestamp-string" } }`                                                                                 |
| GET         | `/v1/users`                                | UserService       | ListUsers                | 列出用户                          | `{ "users": [ { "user_id": "uuid-string-1", "username": "user1", ... }, { "user_id": "uuid-string-2", "username": "user2", ... } ] }`                                                     |
| GET         | `/v1/users/healthz`                        | UserService       | HealthCheck              | 用户服务健康检查                  | `{ "status": "SERVING" }`                                                                                                                                                                 |
| **Room Service** |                                            |                   |                          |                                   |                                                                                                                                                                                           |
| POST        | `/v1/rooms`                                | RoomService       | CreateRoom               | 创建新房间                        | `{ "room": { "room_id": "uuid-string", "room_name": "New Room", "owner_user_id": "owner-uuid", "status": "active", "platform": "bilibili", "platform_room_id": "12345", "area_name": "分区" } }` |
| GET         | `/v1/rooms/{room_id}`                      | RoomService       | GetRoom                  | 获取房间信息（包括房主信息）      | `{ "room": { ... }, "owner": { "user_id": "owner-uuid", "username": "owner_name", ... } }`                                                                                                |
| PATCH       | `/v1/rooms/{room.room_id}`                 | RoomService       | UpdateRoom               | 更新房间信息（目前仅限 status）   | `{ "room": { "room_id": "uuid-string", "room_name": "Room Name", "owner_user_id": "owner-uuid", "status": "inactive", ... } }`                                                              |
| GET         | `/v1/rooms`                                | RoomService       | ListRooms                | 列出房间                          | `{ "rooms": [ { "room_id": "uuid-string-1", "room_name": "Room 1", ... }, { "room_id": "uuid-string-2", "room_name": "Room 2", ... } ] }`                                                |
| GET         | `/v1/rooms:byPlatformId`                   | RoomService       | GetRoomByPlatformID      | 通过平台 ID 获取房间信息          | `{ "room": { ... }, "owner": { ... } }`                                                                                                                                                   |
| GET         | `/v1/rooms/healthz`                        | RoomService       | HealthCheck              | 房间服务健康检查                  | `{ "status": "SERVING" }`                                                                                                                                                                 |
| **Session Service** |                                            |                   |                          |                                   |                                                                                                                                                                                           |
| POST        | `/v1/sessions`                             | SessionService    | CreateSession            | 为房间创建新场次（开始直播）      | `{ "session": { "session_id": "uuid-string", "room_id": "room-uuid", "owner_user_id": "owner-uuid", "start_time": "timestamp-string", "status": "live", ... } }`                           |
| GET         | `/v1/sessions/{session_id}`                | SessionService    | GetSession               | 获取场次信息                      | `{ "session": { "session_id": "uuid-string", "room_id": "room-uuid", ..., "end_time": "timestamp-string", "status": "ended", ... } }`                                                      |
| PUT         | `/v1/sessions/{session_id}/end`            | SessionService    | EndSession               | 结束场次（结束直播）              | `{ "session": { "session_id": "uuid-string", ..., "status": "ended", "end_time": "timestamp-string", ... } }`                                                                              |
| PUT         | `/v1/sessions/{session_id}/aggregates`     | SessionService    | UpdateSessionAggregates  | 更新场次聚合数据（内部调用）      | `{ "session": { "session_id": "uuid-string", ..., "total_danmaku": 100, "total_gifts_value": 5000, ... } }`                                                                               |
| GET         | `/v1/rooms/{room_id}/live_session`         | SessionService    | GetLiveSessionByRoomID   | 获取房间当前直播中的场次          | `{ "session": { "session_id": "live-session-uuid", "room_id": "room-uuid", "status": "live", ... } }`                                                                                       |
| POST        | `/v1/sessions/{session_id}/chat`           | SessionService    | SendChatMessage          | 发送聊天消息（弹幕）              | `{}`                                                                                                                                                                                      |
| GET         | `/v1/rooms/{room_id}/active_session_check` | SessionService    | CheckSessionActive       | 检查房间是否有活跃场次            | `{ "is_active": true, "session_id": "live-session-uuid" }` or `{ "is_active": false }`                                                                                                     |
| GET         | `/v1/sessions/healthz`                     | SessionService    | HealthCheck              | 场次服务健康检查                  | `{ "status": "SERVING" }`                                                                                                                                                                 |
| **Event Service** |                                            |                   |                          |                                   |                                                                                                                                                                                           |
| POST        | `/v1/events:query`                         | EventService      | QueryEvents              | 查询结构化事件                    | `{ "events": [ { "chat_message": { "message_id": "uuid", ... } }, { "user_presence": { ... } } ], "next_page_token": "token-string" }`                                                     |
| GET         | `/v1/events/healthz`                       | EventService      | HealthCheck              | 事件服务健康检查                  | `{ "status": "SERVING" }`                                                                                                                                                                 |
| **Aggregation Service** |                                            |                   |                          |                                   |                                                                                                                                                                                           |
| POST        | `/v1/aggregation/trigger`                  | AggregationService| TriggerAggregation       | 手动触发场次聚合计算              | `{}`                                                                                                                                                                                      |
| GET         | `/v1/aggregation/healthz`                  | AggregationService| HealthCheck              | 聚合服务健康检查                  | `{ "status": "SERVING" }`                                                                                                                                                                 |
| **Realtime Service** |                                            |                   |                          |                                   |                                                                                                                                                                                           |
| GET         | `/v1/realtime/healthz`                     | RealtimeService   | HealthCheck              | 实时服务健康检查                  | `{ "status": "SERVING" }`                                                                                                                                                                 |
| WebSocket   | `/ws/sessions/{sessionID}`                | RealtimeService   | SubscribeSessionEvents   | 订阅场次实时事件 (WebSocket)      | WebSocket 推送 JSON 格式的实时事件消息                                                                                                                                                              |

**注意:**
*   路径中的 `{variable}` 表示路径参数。
*   `PATCH` 方法通常用于部分更新资源。
*   `PUT` 方法通常用于替换资源或执行特定操作（如 `end`）。
*   带有 `:` 的路径（如 `/v1/rooms:byPlatformId`）是 gRPC-Gateway 处理自定义方法的约定。
*   响应体示例仅为典型成功情况 (HTTP 200 OK)，实际响应可能因具体数据或错误情况而异。